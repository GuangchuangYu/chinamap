##' pie plot by ggplot2
##'
##' 
##' @title pie2
##' @param data data.frame
##' @param y y variable
##' @param fill color to fill
##' @param color border color
##' @param alpha transparency
##' @return ggplot2 object
##' @export
##' @author Guangchuang Yu
pie2 <- function(data, y, fill, color, alpha=1) {
    ggplot(data, aes_(x=1, y=y, fill=fill)) +
        geom_bar(stat='identity', alpha=alpha) +
        coord_polar(theta='y') +
        scale_fill_manual(values=color) +
        xlab(NULL) + ylab(NULL) +
        theme_tree() + theme_transparent()
}

##' add a list of pies to map
##'
##' 
##' @title add_pies
##' @param map ggplot map
##' @param locations location data.frame
##' @param pies a list of pies
##' @param sizes size of pie to be added
##' @return ggplot2 object
##' @export
##' @author Guangchuang Yu
add_pies <- function(map, locations, pies, sizes) {
    rn <- rownames(locations)
    for (i in 1:nrow(locations)) {
        nn <- rn[i]
        pos <- locations[nn,] %>% unlist
        map %<>% subview(pies[[i]], x=pos[1], y=pos[2],
                       width  = sizes[[nn]],
                       height = sizes[[nn]])
    }
    return(map)
}

